#!/usr/bin/env k

i:`I$''0:"inputs/9"
nn:(1 0;-1 0;0 1;0 -1)+\:

min:i {{(&/x<y^0N)}[x .y;(x .)'nn y]}/:+!(#i;*#'i)

+//1+(,/i)@&min

g:{{y@&{(9>y)&x<y}[x .z;(x .)'y]}[x;nn y;y]}

f:{{x@&2=(#'x)} (?x,,/g[i]'x)}
fn:{(?x,,/g[i]'x)}

*/{*0 3_x@>x} (#'{f/(,x)}'(+!(#i;*#'i))@&,/min)

