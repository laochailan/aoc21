#!/usr/bin/env k

p:i:-1+`I$'28_'0:"inputs/21"

/part1
s:(#i)#0;n:1;t:0;r:0
d:{n+:3;-6+3*n}
g:{p[t]:10!d[]+p[t];s[t]+:p[t]+1;t::~t;r+:1;s}
l@:*&1000>l:{&/1000>x} g/()

3*r*l

/part2

I:10 22 10 22
id:{I/,/x}
di:{2 2#I\x}
g:{(@[z;x;{np:10!y[0]+x;ns:y[1]+np+1;(np;21&ns)}[y]])}

d:#'=+/1+!3 3 3
s:{id'(!d) g[x]\:di y}
i0:id[((i[0];0);(i[1];0))]=!*/I

tr:{,/s[x]'!*/I}'!2
ed:20<|//'di'!*/I

t:{@[ed*y;tr[x];+;,/{x*.d}'y*~ed]}

a:*'&'21={x[;1]}'di'b:&~~r:(t[1]@t[0]@)/i0
|/+/'(~a;a)*\:r@b

